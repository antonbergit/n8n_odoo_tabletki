# Відповіді на запитання замовника

**Дата створення:** 13 січня 2026  
**Версія:** 1.0  

---

## Контекст

Замовник поставив запитання після створення звіту розширеного аналізу:

1. **Чого бракує тобі в описі завдання?**
2. **Які потоки не мають специфікації?**

Нижче представлені відповіді на основі аналізу первинного завдання (файл `00.Primary_AI_Task_Analysis.md`) та розширеного аналізу (файл `20.Advanced_AI_Task_Analysis.md`).

---

## 1. Чого бракує тобі в описі завдання?

### Відповідь з первинного аналізу (00.Primary_AI_Task_Analysis.md)

**З розділу 1.1 "Оцінка повноти завдання":**

Завдання містить детальну бізнес-логіку, структуру флоу та опис інтеграційних процесів. Однак для початку розробки **критично бракує технічних деталей** у наступних областях:

#### Критичні пропуски:

**1. Автентифікація та credentials:**
   - Не вказано формат Basic Auth для Tabletki (потрібен username/password або token?)
   - Чи потрібні додаткові headers (API keys, authorization tokens)?
   - Де зберігаються credentials у n8n (environment variables, vault)?

**2. Ідентифікатори та мапінг:**
   - `branchID: 30639` - це тестовий чи продуктивний ID?
   - Як формується `Code` товару в Odoo? Це `product.id` чи окреме поле?
   - Яке поле Odoo відповідає за `SupplierCodes.Code` (баркод)?
   - Поле `Dr Brand Value ID` - це related field чи computed? Яка модель?

**3. Тригери статусів в Odoo:**
   - "Зміна статусу повинна тригернути запит" - це потребує **webhook** чи **polling**?
   - Чи є в Odoo автоматичний механізм (automated action, server action)?
   - Якщо polling - яка частота перевірки статусів?

**4. Обробка помилок та retry logic:**
   - Скільки спроб повтору при помилках API?
   - Який timeout для HTTP запитів?
   - Що робити з частково обробленими батчами?

**5. TTN (Транспортна накладна):**
   - Поле `kw_np_tracking_document_name` - це кастомне поле модуля Nova Poshta?
   - Чи завжди є TTN при статусі "Підтверджено"?
   - Що робити, якщо TTN ще не згенерована?

**6. Структура даних Odoo:**
   - Чи всі товари мають `taxes_id` для VAT calculation?
   - Як обробляти товари з множинними податками?
   - Структура поля `order_line` - це Many2many чи One2many?

---

### Детальні запитання до бізнес-аналітика (з розділу 1.2)

#### Блок A: Автентифікація та доступи

**A1.** Надайте тестові credentials для:
   - Odoo (login, password, database name, URL)
   - Tabletki API (login, password або API token)
   - Email для нотифікацій (SMTP settings)

**A2.** Чи є різниця між test та production endpoints для Tabletki?
   - Test: `testenv-import.tabletki.ua` → Production: ?
   - Який `branchID` буде у prod?

**A3.** Чи потрібна двофакторна автентифікація або IP whitelisting?

#### Блок B: Мапінг даних та ідентифікатори

**B1.** Підтвердіть мапінг полів для **Catalog flow**:
```
Odoo Field               → Tabletki Field
─────────────────────────────────────────
product.product.id       → Offers.Code
product.product.name     → Offers.Name
product.product.barcode  → SupplierCodes.Code
Dr Brand Value ID        → Offers.Producer (format: "Brand: X")
taxes_id                 → Offers.VAT (20 або 7)
```
Чи правильно?

**B2.** Поле `Dr Brand Value ID`:
   - Яка повна назва поля в Odoo? (напр., `x_studio_dr_brand_value_id`)
   - Це поле типу Many2one на модель `product.brand`?
   - Як отримати текстове значення бренду?

**B3.** Для `SupplierCodes.ID`:
   - Чому використовується значення `"Barcode"`? Це константа чи змінна?
   - Якщо баркод відсутній - що передавати?

#### Блок C: Статуси та тригери

**C1.** **Booking flow - створення ордеру:**
   - Поле `origin` в `sale.order` - як воно заповнюється?
   - Чи потрібно створювати `res.partner` (контакт) або завжди `TABLETKI_PARTNER_ID = 184588`?
   - Що робити з полем `customer` (ім'я клієнта з Tabletki)?

**C2.** **Trigger на зміну статусу:**
   - Для кроку "Підтверджено → Готово до відправки":
     - Який саме action в Odoo тригерить це? (кнопка Confirm?)
     - State в Odoo: `draft → sale` чи інший?
   - Чи потрібен automated action в Odoo або n8n робить polling?

**C3.** **48 годин для самовивозу:**
   - Після якого саме статусу починається відлік? (4.0 "Обработано"?)
   - Чи є поле `dateTimeCreated` в Odoo для обчислення?
   - Хто відповідає за автоскасування - n8n чи Tabletki?

#### Блок D: Обробка даних та крайові випадки

**D1.** **Stock & Prices flow:**
   - Якщо `qty_available = 0` - чи відправляти такі товари?
   - Фільтр зараз: `Qty available > 0` - чи правильно?

**D2.** **Часткове підтвердження (TC-02):**
   - Як в Odoo позначити, що рядок замовлення частково підтверджено?
   - Чи потрібно створювати окремі `sale.order.line` або змінювати `product_uom_qty`?

**D3.** **Відмова замовлення:**
   - Статус 7 "Скасовано" - чи потрібно передавати `cancelReason` з Odoo?
   - Якщо так - де в Odoo зберігається причина?

**D4.** **TTN обробка:**
   - Чи можлива ситуація, коли TTN змінюється після відправки?
   - Чи потрібен механізм дедуплікації (не відправляти той самий TTN двічі)?

#### Блок E: Технічна інфраструктура

**E1.** **n8n інстанс:**
   - Self-hosted чи n8n Cloud?
   - Версія n8n?
   - Чи є обмеження на execution time (timeout)?

**E2.** **Логування та моніторинг:**
   - Куди писати лоґи? (n8n execution logs, external system, файл?)
   - Яка політика збереження логів?
   - Чи потрібен Sentry / error tracking?

**E3.** **Rate limits Tabletki API:**
   - Яка максимальна кількість запитів на хвилину/годину?
   - Чи потрібен throttling в n8n?

#### Блок F: Тестування

**F1.** Чи є підготовлені тестові дані в Odoo:
   - Товари з тегом `tabletki` ✓
   - Тестові замовлення з різними статусами ✓
   - Різні сценарії VAT (20% та 7%) ✓

**F2.** Критерії acceptance для кожного флоу - чи можна отримати конкретні приклади:
   - JSON payload для тестового товару (Catalog)
   - Приклад відповіді Tabletki з помилкою
   - Тестове замовлення з частковим підтвердженням

---

### Рекомендації щодо уточнень (з розділу 1.3)

**Високий пріоритет (блокують розробку):**
- Credentials та доступи (A1-A3)
- Точний мапінг полів Odoo → Tabletki (B1-B3)
- Механізм тригерів статусів (C1-C3)

**Середній пріоритет (впливають на архітектуру):**
- Обробка помилок та retry (D1-D4)
- Rate limits та інфраструктура (E1-E3)

**Низький пріоритет (можна уточнити під час тестування):**
- Деталі тест-кейсів (F1-F2)

---

### Відповідь з розширеного аналізу (20.Advanced_AI_Task_Analysis.md)

У розширеному аналізі **всі критичні питання були вирішені**, і було надано конкретні деталі:

#### Уточнена інформація, яка була додана:

**1. Технічне середовище (секція 1.3):**
```yaml
n8n:
  version: "1.123.4"
  url: "https://n8n.quickdo.it.com/"
  uptime: "4 тижні без збоїв"
  existing_workflows: 11 (деякі частково реалізовані)
  
odoo:
  url: "https://test.foodok-17ce.odoo.systems"
  auth: "JSON-RPC"
  credentials: "Odoo account (rk2XVyGzAoWlkmEg)"
  
tabletki:
  import_api: "https://testenv-import.tabletki.ua"
  orders_api: "https://testenv-reserve.tabletki.ua"
  auth: "Basic Auth (dU1Xb55U6IzOlAwM)"
  supplier_id: "30638"
  
notifications:
  email: "o.ryhun@quickdo.it.com"
  smtp: "Gmail OAuth2 (oGIDr2s7otQ5m80Z)"
```

**2. Детальна специфікація workflows (секція 1.4):**
- Надано повну структуру всіх 4 workflows з візуальними схемами
- Описано кожен крок з конфігурацією
- Додано мапінг полів
- Визначено error handling для кожного flow

**3. Критерії приймання (секція 1.5):**
- Функціональні критерії для кожного workflow
- Нефункціональні критерії (email, логування, документація)
- Технічні критерії (credentials, error handling, валідація)

**Висновок:** Розширений аналіз надає **конкретні відповіді** на всі критичні питання, які були підняті в первинному аналізі.

---

## 2. Які потоки не мають специфікації?

### Відповідь на основі обох аналізів

#### Потоки з повною специфікацією (реалізовані або детально описані):

**З розширеного аналізу (секція 1.4):**

1. ✅ **CATALOG SYNC (Workflow 1)** - Повна специфікація
   - Назва: `FoodOK_Tabletki_Catalog_Daily_Sync`
   - Тригер: Schedule (щодня о 03:00)
   - Детальна логіка: 7 кроків з візуальною схемою
   - Мапінг полів: Odoo → Tabletki
   - Error handling: описано

2. ✅ **STOCK SYNC (Workflow 2)** - Повна специфікація
   - Назва: `FoodOK_Tabletki_Stock_Every5Min_Sync`
   - Тригер: Schedule (кожні 5 хвилин)
   - Детальна логіка: 7 кроків з візуальною схемою
   - Мапінг полів: stock.quant + product.product → Tabletki
   - Error handling: описано

3. ✅ **BOOKING FLOW (Workflow 3)** - Повна специфікація
   - Назва: `FoodOK_Tabletki_Booking_Bidirectional`
   - Тригер: Schedule (кожні 5 хвилин)
   - Складається з 2 паралельних flow:
     - **Flow A:** Нові замовлення (Tabletki → Odoo)
     - **Flow B:** Відправка TTN (Odoo → Tabletki)
   - Детальна логіка для обох flow
   - Error handling: описано

4. ✅ **STATUS SYNC (Workflow 4)** - Повна специфікація
   - Назва: `FoodOK_Tabletki_Status_Cancellations_Sync`
   - Тригер: Schedule (кожні 5 хвилин)
   - Детальна логіка: 8 кроків з візуальною схемою
   - Обробка скасувань клієнтом
   - Error handling: описано

---

#### Потоки БЕЗ повної специфікації (згадані, але не реалізовані):

На основі аналізу первинного завдання (`Primary BA task.txt`) та файлу з відповідями БА (`10.BA_Answers.txt`):

**1. ❌ САМОВИВІЗ (Pickup Flow) - НЕ має повної специфікації**

**Статус:** Згадується в завданні, але НЕ реалізований і НЕ має детальної специфікації

**Що відомо:**
- Замовлення резервується користувачем
- Клієнт забирає його приїхавши в офіс
- Має автоматичне скасування через 48 годин якщо не забрано

**Що НЕ специфіковано:**
- Повна логіка workflow
- Структура n8n flow
- Мапінг статусів
- Механізм автоскасування через 48 годин
- Тригери та schedule

**З первинного аналізу (розділ 2.1, етап 5):**
```
| **5. Самовивіз Flow** | | | **12-16** |
| 5.1 | Створення ордеру (аналогічно 4.1, але без delivery fields) | Середня | 4-6 |
| 5.2 | Статус 2 → 4 (Confirm в Odoo) | Середня | 3-4 |
| 5.3 | Статус 4 → 6 (Done в Odoo) | Середня | 3-4 |
| 5.4 | Автоскасування через 48 год (TC-07) | Висока | 4-6 |
| 5.5 | Тестування всіх сценаріїв | Середня | 2-3 |
```

**З відповідей БА (10.BA_Answers.txt):**
```
C2.** **Trigger на зміну статусу:** Це питання стосуються флоу Самовивіз, 
який ще не реалізовано. Відповідно щоб на них відповісти треба почати 
реалізацію і визначити як краще. Тобто питання відкриті.
```

**Оцінка часу на реалізацію:** 12-16 годин

---

**2. ❌ СТВОРЕННЯ КОНТАКТУ (Contact Creation Sub-flow) - НЕ має повної специфікації**

**Статус:** Описано як бажаний функціонал, але НЕ реалізований

**Що відомо з завдання (розділ "Створення контакту"):**
1. Отримати бронювання з Tabletki (разом з даними клієнта та доставки)
2. Перевірити в Odoo, чи існує контакт з таким номером телефону
3. Якщо контакт знайдено — використати існуючий `partner_id`
4. Якщо контакт не знайдено — створити новий контакт в Odoo на основі даних з Tabletki
5. Контакт позначити як Tabletki (тег)
6. Повернути `partner_id` у флоу створення замовлення

**Що НЕ специфіковано:**
- Повна структура sub-flow в n8n
- Інтеграція з існуючим Booking Flow
- Обробка дублікатів контактів
- Валідація даних контакту
- Error handling для створення контакту

**З відповідей БА (10.BA_Answers.txt):**
```
C1.** **Booking flow - створення ордеру:**
  - Чи потрібно створювати `res.partner` (контакт) або завжди `TABLETKI_PARTNER_ID = 184588`?
  В нинішній реалізації partnerID статичний і контакт не створюється. 
  Натомість в описі завдання окремо викладено нереалізований підхід 
  при якому буде створюватись контакт.
```

**Примітка:** В поточній реалізації використовується статичний `TABLETKI_PARTNER_ID = 184588`

---

**3. ⚠️ ЧАСТКОВЕ ПІДТВЕРДЖЕННЯ (Partial Confirmation) - Неповна специфікація**

**Статус:** Згадується в тест-кейсах, але детальна логіка не описана

**Що відомо:**
- Тест-кейс TC-02: "Бронь підтверджена частково (відсутні декілька товарів), здійснено продаж"
- В Odoo можливе часткове підтвердження кількостей

**Що НЕ специфіковано:**
- Як саме відбувається модифікація `sale.order.line` в Odoo
- Як передається інформація про часткове підтвердження в Tabletki
- Чи створюються окремі рядки замовлення чи змінюється `product_uom_qty`

**З відповідей БА (10.BA_Answers.txt):**
```
**D2.** **Часткове підтвердження (TC-02):** Часткове підтвердження це фактично 
і є звичайне підтвердження. Просто в таблеткі відправляємо змінені позиції
(змінено кількість, видалено чи добавлено товар ітп.) відповідно з точки зору 
флоу Часткове підтвердження не є якиймось окремим підпроцесом який хоч якось би 
відрізнявся від звичайного підтвердження
```

**Висновок:** Не потребує окремого flow, але логіка має бути покрита в Booking Flow

---

**4. ⚠️ ПРИЧИНИ ВІДМОВИ (Cancellation Reasons) - MVP без специфікації**

**Статус:** Свідомо виключено з MVP

**З відповідей БА (10.BA_Answers.txt):**
```
**D3.** **Відмова замовлення:** Оскільки працюємо над проектом в форматі MVP,
То в нинішній реалізації CancelReason не відправляю оскільки це не мандаторі поле.
```

**Висновок:** Не потребує специфікації в поточній версії

---

**5. ⚠️ TTN ДЕДУПЛІКАЦІЯ (TTN Deduplication) - Неповна специфікація**

**Статус:** Визнано як потрібний функціонал, але не реалізовано

**З відповідей БА (10.BA_Answers.txt):**
```
D4 - Чи потрібен механізм дедуплікації (не відправляти той самий TTN двічі)? 
Думаю так. Я цього не покрив. Можливо
```

**Що потрібно специфікувати:**
- Механізм збереження вже відправлених TTN
- Логіка перевірки перед відправкою
- Обробка оновлення TTN (якщо змінився)

---

### Підсумкова таблиця потоків без специфікації

| # | Потік | Статус | Пріоритет | Оцінка часу |
|---|-------|--------|-----------|-------------|
| 1 | **Самовивіз (Pickup Flow)** | ❌ Не специфіковано, не реалізовано | Високий | 12-16 год |
| 2 | **Створення контакту (Contact Creation)** | ❌ Не специфіковано, не реалізовано | Середній | 4-6 год (включено в Booking) |
| 3 | **Часткове підтвердження** | ⚠️ Логіка існує, окремий flow не потрібен | Низький | Покрито в Booking Flow |
| 4 | **Причини відмови** | ⚠️ MVP без цього функціоналу | Низький | 1-2 год (якщо додавати) |
| 5 | **TTN дедуплікація** | ⚠️ Потрібно додати до Booking Flow | Середній | 2-3 год |

---

## Висновки

### По питанню 1 (Чого бракує):

**Первинний аналіз** виявив критичні пропуски в 6 областях з детальними запитаннями в 6 блоках (A-F).

**Розширений аналіз** надав відповіді на більшість критичних питань, додавши:
- Конкретні credentials та URLs
- Детальні специфікації всіх 4 workflows
- Мапінг полів
- Критерії приймання
- Оцінку часу виконання

**Що все ще може бракувати:**
- Продуктивні (production) credentials
- Детальна специфікація потоку "Самовивіз"
- Механізм дедуплікації TTN
- Специфікація створення контактів (якщо потрібно в майбутньому)

### По питанню 2 (Які потоки не мають специфікації):

**4 основні потоки мають повну специфікацію:**
1. ✅ Catalog Sync
2. ✅ Stock Sync
3. ✅ Booking Flow (з TTN)
4. ✅ Status Sync

**1 основний потік НЕ має специфікації:**
1. ❌ **Самовивіз (Pickup Flow)** - згадується в завданні, але не реалізований і не має детальної специфікації

**Додаткові функціональності без повної специфікації:**
- ❌ Створення контакту (Contact Creation) - описано концептуально, не реалізовано
- ⚠️ TTN дедуплікація - визнано як потрібне, але не покрито
- ⚠️ Причини відмови - свідомо виключено з MVP

---

**Документ підготовлено:** 13 січня 2026  
**На основі файлів:**
- `00.Primary_AI_Task_Analysis.md` (первинний аналіз)
- `20.Advanced_AI_Task_Analysis.md` (розширений аналіз)
- `Primary BA task.txt` (первинне завдання від БА)
- `10.BA_Answers.txt` (відповіді БА на запитання)
